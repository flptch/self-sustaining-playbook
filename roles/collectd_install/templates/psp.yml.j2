---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: collectd
spec:
  allowPrivilegeEscalation: true
  allowedCapabilities:
  - '*'
  allowedUnsafeSysctls:
  - '*'
  fsGroup:
    rule: RunAsAny
  hostNetwork: true
  hostPorts:
  - max: 9104
    min: 9103
  privileged: true
  runAsUser:
    rule: RunAsAny
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    rule: RunAsAny
  allowedHostPaths:
    - pathPrefix: "{{ host_collectd_folder }}"
    - pathPrefix: "/proc"
    - pathPrefix: "/usr/local/var/run/openvswitch/"
    - pathPrefix: "/var/run/.client"
    - pathPrefix: "/var/run/dpdk/rte/telemetry"
{% if enable_pkgpower_plugin %}
    - pathPrefix: "/sys/devices/virtual/powercap/intel-rapl/"
{% endif %}
    - pathPrefix: "/sys/kernel/mm/hugepages"
    - pathPrefix: "/sys/devices/system/cpu"
    - pathPrefix: "{{ unixsock_host_socket_dir }}"
  volumes:
    - "configMap"
    - "downwardAPI"
    - "emptyDir"
    - "persistentVolumeClaim"
    - "secret"
    - "projected"
    - "hostPath"
